# TinyMUSH Regression Tests - Time Functions
# Functions: convsecs(), convtime(), etimefmt(), secs(), time(), timefmt()

# secs() - Returns seconds since epoch (Jan 1, 1970)
# We can't test exact value but we can verify it returns a large number
think secs() | 
think isnum(secs()) | 1

# time() - Returns current time string
# We can't test exact value but we can verify it's not empty
think time() | 
think gt(strlen(time()),0) | 1

# convsecs() - Convert seconds to time string
# Note: Output format is affected by local timezone
# Timestamp 0 is epoch, but displays in local timezone
think strlen(convsecs(0)) | 24
think strlen(convsecs(86400)) | 24
think strlen(convsecs(709395774)) | 24

# convtime() - Convert time string to seconds
# Format: Ddd MMM DD HH:MM:SS YYYY
# The exact conversion depends on timezone
think isnum(convtime(Thu Jan  1 00:00:00 1970)) | 1
think isnum(convtime(Fri Jan  2 00:00:00 1970)) | 1
think convtime(invalid) | -1
think convtime() | -1

# timefmt() - Format current or given time
# Test basic formatting codes - current time
think strlen(timefmt($Y)) | 4
think isnum(timefmt($Y)) | 1
think strlen(timefmt($m)) | 2
think isnum(timefmt($m)) | 1
think strlen(timefmt($d)) | 2
think isnum(timefmt($d)) | 1

# timefmt with specific timestamp 0 (1970-01-01 00:00:00 in UTC)
think strlen(timefmt($Y, 0)) | 4
think strlen(timefmt($m, 0)) | 2
think strlen(timefmt($d, 0)) | 2

# timefmt format codes (current or arbitrary timestamp)
think strlen(timefmt($a)) | 3
think strlen(timefmt($b)) | 3
think strlen(timefmt($H)) | 2
think strlen(timefmt($M)) | 2
think strlen(timefmt($S)) | 2

# timefmt - day/month names
think gt(strlen(timefmt($A)),2) | 1
think gt(strlen(timefmt($B)),2) | 1
think strlen(timefmt($w)) | 1

# timefmt - combined formats (just verify length)
think eq(strlen(timefmt($Y-$m-$d)),10) | 1
think eq(strlen(timefmt($H:$M:$S)),8) | 1

# timefmt - literal dollar sign
think timefmt(Cost: $$100) | Cost: $100

# etimefmt() - Format elapsed time (seconds to days/hours/mins/secs)
# Test basic increments: d(days), h(hours), m(minutes), s(seconds)

# 65 seconds = 1 minute, 5 seconds
think etimefmt($m, 65) | 1
think etimefmt($s, 65) | 5
think etimefmt($h, 65) | 0
think etimefmt($d, 65) | 0

# 3665 seconds = 1 hour, 1 minute, 5 seconds
think etimefmt($h, 3665) | 1
think etimefmt($m, 3665) | 1
think etimefmt($s, 3665) | 5
think etimefmt($d, 3665) | 0

# 86400 seconds = 1 day
think etimefmt($d, 86400) | 1
think etimefmt($h, 86400) | 0
think etimefmt($m, 86400) | 0
think etimefmt($s, 86400) | 0

# 90061 seconds = 1 day, 1 hour, 1 minute, 1 second
think etimefmt($d, 90061) | 1
think etimefmt($h, 90061) | 1
think etimefmt($m, 90061) | 1
think etimefmt($s, 90061) | 1

# etimefmt with capital letters (zero-padding)
think etimefmt($S, 65) | 5
think etimefmt($M, 3665) | 1
think etimefmt($H, 3665) | 1
think etimefmt($D, 90061) | 1

# etimefmt with x modifier (append type)
think etimefmt($xs, 65) | 5s
think etimefmt($xm, 65) | 1m
think etimefmt($xh, 65) | 0h

# etimefmt with z modifier (zero suppression)
think etimefmt($xzh $xzm $xs, 65) | 1m 5s
think etimefmt($xzh $xzm $xs, 3665) | 1h 1m 5s
think etimefmt($xzs, 0) | 

# etimefmt combined format
think etimefmt($h hrs $m mins $s secs, 7273) | 2 hrs 1 mins 13 secs
think etimefmt($H:$M:$S, 65) | 0:1:5
think etimefmt($H:$M:$S, 3665) | 1:1:5

# etimefmt with formatting (capital for padding)
think etimefmt($2H:$2M:$2S, 65) | 00:01:05
think etimefmt($2H:$2M:$2S, 3665) | 01:01:05

# etimefmt with clock format
think etimefmt($M:$S, 60) | 1:0
think etimefmt($2M:$2S, 60) | 01:00

# etimefmt with all modifier
think etimefmt($xa, 65) | 1m
think etimefmt($xa, 3665) | 1h
think etimefmt($xa, 86400) | 1d
think etimefmt($xa, 5) | 5s

# Round-trip conversion tests
think convtime(convsecs(0)) | 0
think convtime(convsecs(86400)) | 86400

# Verify time() format matches convtime() expectations
think isnum(convtime(time())) | 1

# secs() and convtime(time()) should be approximately same
think gt(abs(sub(secs(),convtime(time()))),5) | 0
