# Attribute function tests
# Format: command | expected substring

# Setup
@create FuncObj | FuncObj created
@set FuncObj=ATTR1:Hello | Set.
@set FuncObj=ATTR2:World | Set.
@set FuncObj=EXPR:add(2,3) | Set.
@set FuncObj=UFUNC:%0-%1 | Set.
@set FuncObj=GREP1:alpha beta | Set.
@set FuncObj=GREP2:Gamma alpha | Set.
@set FuncObj=CALLATTR:%0-%1 | Set.
@set FuncObj=ULOCAL:%0 | Set.
@set FuncObj=UPRIVATE:%0 | Set.
@set me=VTEST:VT | Set.

# Pronoun/possessive helpers
think [aposs(#1)] | its
think [poss(#1)] | its
think [subj(me)] | it

# Default helpers
think [default(FuncObj/MISSING,DefVal)] | DefVal
think [edefault(FuncObj/MISSING,add(2,3))] | 5

# Eval helpers
think [eval(add(2,3))] | 5
think [get(FuncObj/ATTR1)] | Hello
think [eval(get(FuncObj/EXPR))] | 5
think [get(FuncObj/ATTR2)] | World
think [xget(FuncObj,ATTR2)] | World

# Attribute presence
think [hasattr(FuncObj,ATTR1)] | 1
think [hasattrp(FuncObj,ATTR1)] | 1
think [lattr(FuncObj)] | ATTR1
think [nattr(FuncObj)] | 9
think [v(vtest)] | VT

# Object lookup
think [obj(#1)] | it

# U-function calls
think [eval(u(FuncObj/UFUNC,foo,bar))] | foo-bar
think [udefault(FuncObj/MISSING,DefCall)] | DefCall

# Advanced: grep family (case sensitive/insensitive/regex/wild)
think [grep(FuncObj,*,alpha)] | GREP1
think [grepi(FuncObj,*,ALPHA)] | GREP1
think [regrep(FuncObj,*,alpha)] | GREP1
think [regrepi(FuncObj,*,ALPHA)] | GREP1
think [wildgrep(FuncObj,*,*alpha*)] | GREP1

# Advanced: object call/eval
think [objcall(FuncObj,FuncObj/CALLATTR,hi,there)] | hi-there
think [objeval(FuncObj,u(CALLATTR,1,2))] | 1-2

# Advanced: local/private ufun
think [ulocal(FuncObj/ULOCAL,localval)] |
think [uprivate(FuncObj/UPRIVATE,privval)] |

# Advanced: zfun (may return error or value; accept any output)
@create ZoneObj | ZoneObj created
@set ZoneObj=ZONE | Set.
&ZHELLO ZoneObj=[capstr(name(%#))] waves from the zone. | Set.
&ZGREET ZoneObj=[ifelse(strlen(%0),cat(Hello, ,%0!),Hello from the zone!)] | Set.
@chzone here=ZoneObj | Zone changed.
@chzone me=ZoneObj | Zone changed.
think [zfun(ZHELLO)] | Wizard waves from the zone.
think [zfun(ZGREET,Tester)] | Hello  Tester!
@destroy ZoneObj | crumble

# Clean up
@destroy FuncObj | crumble
