# TinyMUSH Regression Tests - Structure Functions
# Functions: construct(), destruct(), load(), linstances(), lstructures(), modify(), read(), structure(), unload(), unstructure(), write(), z()
# Format: command | expected substring

# Define a simple structure: st_test with two integer components
think structure(st_test,xcoord ycoord,i i,0 0) | 1

# Construct an instance with defaults and verify unload
think construct(st_blank,st_test) | 1
think unload(st_blank) | 0 0

# Load values into a new instance using default space delimiter
think load(st_space,st_test,3 4) | 1
think z(st_space,ycoord) | 4
think unload(st_space,~) | 3~4

# Construct with named components and custom delimiter
think construct(st_named,st_test,xcoord ycoord,2~5,~) | 1
think unload(st_named) | 2 5

# Modify component values
think modify(st_named,xcoord ycoord,7 8) | 2
think z(st_named,xcoord) | 7
think z(st_named,ycoord) | 8

# write to attribute and verify empty output via strlen
think strlen(write(me/coords,st_named)) | 0

# Destruct a temp instance, then read back from attribute to a new instance
think destruct(st_space) | 1
think read(me/coords,st_loaded,st_test) | 1
think unload(st_loaded,~) | 7~8

# lstructures() contains st_test; linstances() contains st_loaded
think gt(index(lstructures(),st_test),0) | 1
think gt(index(linstances(),st_loaded),0) | 1

# unload() of non-existent instance returns empty
think strlen(unload(st_missing)) | 0

# Cleanup: destruct instances and unstructure definition
think destruct(st_blank) | 1
think destruct(st_named) | 1
think destruct(st_loaded) | 1
think unstructure(st_test) | 1
