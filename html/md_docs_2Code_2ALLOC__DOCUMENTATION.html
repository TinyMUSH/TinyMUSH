<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TinyMUSH: TinyMUSH Memory Management Subsystem (&lt;tt&gt;alloc.c&lt;/tt&gt;)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TinyMUSH<span id="projectnumber">&#160;3.3</span>
   </div>
   <div id="projectbrief">TinyMUSH Server</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">TinyMUSH Memory Management Subsystem (&lt;tt&gt;alloc.c&lt;/tt&gt;)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md63"></a></p>
<h1><a class="anchor" id="autotoc_md64"></a>
Overview</h1>
<p><code><a class="el" href="alloc_8c.html" title="Tracked memory allocation, leak detection, and buffer safety helpers.">alloc.c</a></code> implements a comprehensive, tracked memory management system for TinyMUSH. It provides safety-critical wrappers around standard C memory functions with built-in bounds checking, overflow detection, and detailed memory tracking capabilities.</p>
<p><b>Key Features:</b></p><ul>
<li>Tracked memory allocation with overflow detection via magic numbers</li>
<li>Protection against integer overflow in size calculations</li>
<li>Buffer overflow prevention with automatic bounds checking</li>
<li>Comprehensive logging and memory statistics</li>
<li>Safe versions of string operations (sprintf, strcat, strcpy, etc.)</li>
<li>Support for aligned memory allocation (cache-line optimization)</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md66"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md67"></a>
Memory Tracking Structure (MEMTRACK)</h2>
<p>Each allocation is tracked with a <code>MEMTRACK</code> structure containing:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">void</span> *bptr;              <span class="comment">// Pointer to user&#39;s memory block</span></div>
<div class="line">    <span class="keywordtype">size_t</span> size;             <span class="comment">// Size of allocated memory</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *file;        <span class="comment">// Source file where allocation occurred</span></div>
<div class="line">    <span class="keywordtype">int</span> line;                <span class="comment">// Line number in source file</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *function;    <span class="comment">// Function name</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *var;         <span class="comment">// Variable name</span></div>
<div class="line">    <span class="keyword">struct </span>memtrack *next;   <span class="comment">// Linked list pointer</span></div>
<div class="line">    uint64_t *magic;         <span class="comment">// Magic number for overflow detection</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md68"></a>
Memory Layout</h2>
<div class="fragment"><div class="line">[MEMTRACK Header (variable)]</div>
<div class="line">[Aligned allocation marker]</div>
<div class="line">[User Data (size bytes)]</div>
<div class="line">[Magic Number (uint64_t)]</div>
<div class="line">^bptr points here         ^magic points here</div>
</div><!-- fragment --><p>The magic number (<code>0xDEADBEEFCAFEBABE</code>) is placed after the user data to detect buffer overruns.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md70"></a>
Core Functions</h1>
<h2><a class="anchor" id="autotoc_md71"></a>
Memory Allocation</h2>
<h3><a class="anchor" id="autotoc_md72"></a>
<code>__xmalloc(size_t size, const char *file, int line, const char *function, const char *var)</code></h3>
<p><b>Purpose:</b> Tracked malloc replacement with zero-initialization</p>
<p><b>Usage:</b> </p><div class="fragment"><div class="line"><span class="comment">// Macro wrapper (recommended):</span></div>
<div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(1024, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Direct call (not recommended):</span></div>
<div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_function" href="alloc_8c.html#a3133f65ceaa1203d553920c83380a8c8">__xmalloc</a>(1024, __FILE__, __LINE__, __func__, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="ttc" id="aalloc_8c_html_a3133f65ceaa1203d553920c83380a8c8"><div class="ttname"><a href="alloc_8c.html#a3133f65ceaa1203d553920c83380a8c8">__xmalloc</a></div><div class="ttdeci">void * __xmalloc(size_t size, const char *file, int line, const char *function, const char *var)</div><div class="ttdoc">Tracked version of malloc().</div><div class="ttdef"><b>Definition</b> alloc.c:115</div></div>
<div class="ttc" id="amacros_8h_html_a1f2dc397904297d0a9ba598093b19976"><div class="ttname"><a href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a></div><div class="ttdeci">#define XMALLOC(s, v)</div><div class="ttdoc">XMALLOC related macros.</div><div class="ttdef"><b>Definition</b> macros.h:21</div></div>
</div><!-- fragment --><p><b>Features:</b></p><ul>
<li>Aligned allocation using C11 <code>aligned_alloc</code>, POSIX <code>posix_memalign</code>, or standard <code>malloc</code></li>
<li>Automatic zero-initialization of allocated memory</li>
<li>Magic number placement for overflow detection</li>
<li>Logging support via <code>mushconf.malloc_logger</code></li>
</ul>
<p><b>Returns:</b> Pointer to allocated memory, or NULL on failure</p>
<hr  />
<h3><a class="anchor" id="autotoc_md74"></a>
<code>__xcalloc(size_t nmemb, size_t size, const char *file, int line, const char *function, const char *var)</code></h3>
<p><b>Purpose:</b> Tracked calloc replacement with overflow protection</p>
<p><b>Usage:</b> </p><div class="fragment"><div class="line"><span class="comment">// Allocate array of 100 elements, 16 bytes each</span></div>
<div class="line"><span class="keywordtype">int</span> *array = XCALLOC(100, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <span class="stringliteral">&quot;array&quot;</span>);</div>
</div><!-- fragment --><p><b>Features:</b></p><ul>
<li><b>Integer overflow protection:</b> Checks if <code>nmemb * size &gt; SIZE_MAX</code> before allocation</li>
<li>Returns NULL if overflow would occur (no abort/crash)</li>
<li>Delegates to <code>__xmalloc</code> for actual allocation</li>
</ul>
<p><b>Critical:</b> Always check for integer overflow when multiplying user-controlled dimensions: </p><div class="fragment"><div class="line"><span class="comment">// Safe:</span></div>
<div class="line"><span class="keywordtype">int</span> *matrix = XCALLOC(rows, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>*), <span class="stringliteral">&quot;matrix&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// NOT safe if rows comes from user input without validation:</span></div>
<div class="line"><span class="comment">// Could overflow if rows * sizeof(int*) &gt; SIZE_MAX</span></div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md76"></a>
<code>__xrealloc(void *ptr, size_t size, const char *file, int line, const char *function, const char *var)</code></h3>
<p><b>Purpose:</b> Tracked realloc with safe resizing</p>
<p><b>Behavior:</b></p><ul>
<li>If <code>ptr</code> is NULL: equivalent to malloc</li>
<li>If <code>size</code> is 0 and <code>ptr</code> is not NULL: equivalent to free</li>
<li>Otherwise: allocates new block, copies min(old_size, new_size) bytes, frees old block</li>
</ul>
<p><b>Usage:</b> </p><div class="fragment"><div class="line">buffer = XREALLOC(buffer, 2048, <span class="stringliteral">&quot;buffer&quot;</span>);  <span class="comment">// Grow</span></div>
<div class="line">buffer = XREALLOC(buffer, 512, <span class="stringliteral">&quot;buffer&quot;</span>);   <span class="comment">// Shrink</span></div>
<div class="line">buffer = XREALLOC(buffer, 0, <span class="stringliteral">&quot;buffer&quot;</span>);     <span class="comment">// Free</span></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md78"></a>
Memory Deallocation</h2>
<h3><a class="anchor" id="autotoc_md79"></a>
<code>__xfree(void *ptr)</code></h3>
<p><b>Purpose:</b> Tracked free with overflow detection</p>
<p><b>Usage:</b> </p><div class="fragment"><div class="line">XFREE(buffer);  <span class="comment">// Macro wrapper</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// or direct call:</span></div>
<div class="line"><span class="keywordtype">int</span> overrun = <a class="code hl_function" href="alloc_8c.html#adc770c55d160860dca77d400a7349421">__xfree</a>(buffer);</div>
<div class="ttc" id="aalloc_8c_html_adc770c55d160860dca77d400a7349421"><div class="ttname"><a href="alloc_8c.html#adc770c55d160860dca77d400a7349421">__xfree</a></div><div class="ttdeci">int __xfree(void *ptr)</div><div class="ttdoc">Tracked version of free().</div><div class="ttdef"><b>Definition</b> alloc.c:348</div></div>
</div><!-- fragment --><p><b>Return Value:</b></p><ul>
<li><code>0</code>: Buffer was valid and not overrun</li>
<li><code>1</code>: Buffer was valid but <b>OVERRUN DETECTED</b> (magic number corrupted)</li>
<li>(Function always succeeds; overrun is logged)</li>
</ul>
<p><b>Critical:</b> Always check for overruns in debugging: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (XFREE(buffer)) {</div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a>(<a class="code hl_define" href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a>, <span class="stringliteral">&quot;MEM&quot;</span>, <span class="stringliteral">&quot;ERROR&quot;</span>, <span class="stringliteral">&quot;Buffer overrun detected!&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="aconstants_8h_html_a70f52cf948e57d4338de17a52f8e1a0a"><div class="ttname"><a href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a></div><div class="ttdeci">#define LOG_ALWAYS</div><div class="ttdef"><b>Definition</b> constants.h:1469</div></div>
<div class="ttc" id="amacros_8h_html_adba1624513b5ccddfc8bc0831f9cbf45"><div class="ttname"><a href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a></div><div class="ttdeci">#define log_write(i, p, s, f,...)</div><div class="ttdoc">Log related macros.</div><div class="ttdef"><b>Definition</b> macros.h:220</div></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md81"></a>
Memory Inspection</h2>
<h3><a class="anchor" id="autotoc_md82"></a>
<code>__xfind(void *ptr)</code></h3>
<p><b>Purpose:</b> Find MEMTRACK entry for any pointer in allocated block</p>
<p><b>Usage:</b> </p><div class="fragment"><div class="line">MEMTRACK *info = <a class="code hl_function" href="alloc_8c.html#a39788016153b54df3b35aefa562b9e6d">__xfind</a>(buffer);</div>
<div class="line"><span class="keywordflow">if</span> (info) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Allocated at %s:%d in %s\n&quot;</span>, </div>
<div class="line">           info-&gt;file, info-&gt;line, info-&gt;function);</div>
<div class="line">}</div>
<div class="ttc" id="aalloc_8c_html_a39788016153b54df3b35aefa562b9e6d"><div class="ttname"><a href="alloc_8c.html#a39788016153b54df3b35aefa562b9e6d">__xfind</a></div><div class="ttdeci">MEMTRACK * __xfind(void *ptr)</div><div class="ttdoc">Search the tracking list for a pointer and return it's information.</div><div class="ttdef"><b>Definition</b> alloc.c:281</div></div>
</div><!-- fragment --><p><b>Returns:</b> Pointer to MEMTRACK structure, or NULL if not found</p>
<hr  />
<h3><a class="anchor" id="autotoc_md84"></a>
<code>__xcheck(void *ptr)</code></h3>
<p><b>Purpose:</b> Verify buffer integrity without freeing</p>
<p><b>Return Values:</b></p><ul>
<li><code>1</code>: Buffer is valid and not overrun</li>
<li><code>0</code>: Buffer is valid but <b>OVERRUN DETECTED</b></li>
<li><code>2</code>: Buffer is not tracked (unknown allocation)</li>
</ul>
<p><b>Usage:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="alloc_8c.html#a6fb3e6eacbda5141d4aa7c2fb0ec048b">__xcheck</a>(buffer);</div>
<div class="line"><span class="keywordflow">if</span> (status == 0) {</div>
<div class="line">    <span class="comment">// ALERT: Buffer overrun!</span></div>
<div class="line">}</div>
<div class="ttc" id="aalloc_8c_html_a6fb3e6eacbda5141d4aa7c2fb0ec048b"><div class="ttname"><a href="alloc_8c.html#a6fb3e6eacbda5141d4aa7c2fb0ec048b">__xcheck</a></div><div class="ttdeci">int __xcheck(void *ptr)</div><div class="ttdoc">Check if a buffer wasn't overrun.</div><div class="ttdef"><b>Definition</b> alloc.c:309</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md86"></a>
String Functions</h1>
<h2><a class="anchor" id="autotoc_md87"></a>
Dynamic String Creation</h2>
<h3><a class="anchor" id="autotoc_md88"></a>
<code>__xasprintf(const char *file, int line, const char *function, const char *var, const char *format, ...)</code></h3>
<p><b>Purpose:</b> Printf-style dynamic string allocation</p>
<p><b>Usage:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> *name = XASPRINTF(<span class="stringliteral">&quot;player_name&quot;</span>, <span class="stringliteral">&quot;Hello %s!&quot;</span>, <span class="stringliteral">&quot;World&quot;</span>);</div>
<div class="line"><span class="comment">// Returns: &quot;Hello World!&quot;</span></div>
<div class="line"><span class="comment">// Must be freed with XFREE(name)</span></div>
</div><!-- fragment --><p><b>Features:</b></p><ul>
<li>Calculates exact size needed (no buffer overflow possible)</li>
<li>Returns NULL on formatting error</li>
<li>Memory is tracked like all other X* allocations</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md90"></a>
<code>__xavsprintf(const char *file, int line, const char *function, const char *var, const char *format, va_list va)</code></h3>
<p><b>Purpose:</b> va_list version of asprintf</p>
<p><b>Usage:</b> In functions that receive variadic arguments: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> log_message(<span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...) {</div>
<div class="line">    va_list ap;</div>
<div class="line">    va_start(ap, format);</div>
<div class="line">    <span class="keywordtype">char</span> *msg = <a class="code hl_function" href="alloc_8c.html#add0cb4a42b0f665e302370a23949e2ef">__xavsprintf</a>(__FILE__, __LINE__, __func__, <span class="stringliteral">&quot;msg&quot;</span>, format, ap);</div>
<div class="line">    va_end(ap);</div>
<div class="line">    <span class="comment">// Use msg...</span></div>
<div class="line">    XFREE(msg);</div>
<div class="line">}</div>
<div class="ttc" id="aalloc_8c_html_add0cb4a42b0f665e302370a23949e2ef"><div class="ttname"><a href="alloc_8c.html#add0cb4a42b0f665e302370a23949e2ef">__xavsprintf</a></div><div class="ttdeci">char * __xavsprintf(const char *file, int line, const char *function, const char *var, const char *format, va_list va)</div><div class="ttdoc">Tracked vsprintf replacement that create a new formatted string buffer.</div><div class="ttdef"><b>Definition</b> alloc.c:481</div></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md92"></a>
Safe String Operations</h2>
<p>All safe string functions perform automatic bounds checking against the tracked buffer size.</p>
<h3><a class="anchor" id="autotoc_md93"></a>
<code>__xstrcpy(char *dest, const char *src)</code></h3>
<ul>
<li>Copies src to dest with buffer overflow protection</li>
<li>If dest is tracked: copies at most <code>buffer_size - 1</code> bytes</li>
<li>If dest is untracked: performs regular strcpy (less safe)</li>
</ul>
<h3><a class="anchor" id="autotoc_md94"></a>
<code>__xstrncpy(char *dest, const char *src, size_t n)</code></h3>
<ul>
<li>Copies at most n bytes with bounds checking</li>
<li>Automatically limits to buffer size if tracked</li>
</ul>
<h3><a class="anchor" id="autotoc_md95"></a>
<code>__xstrcat(char *dest, const char *src)</code></h3>
<ul>
<li>Appends src to dest with overflow protection</li>
<li>Calculates remaining space in buffer</li>
</ul>
<h3><a class="anchor" id="autotoc_md96"></a>
<code>__xstrncat(char *dest, const char *src, size_t n)</code></h3>
<ul>
<li>Appends at most n bytes with bounds checking</li>
</ul>
<h3><a class="anchor" id="autotoc_md97"></a>
<code>__xstrccat(char *dest, char c)</code> / <code>__xstrnccat(char *dest, char c, size_t n)</code></h3>
<ul>
<li>Appends single character to string</li>
<li>Ensures null termination</li>
</ul>
<h3><a class="anchor" id="autotoc_md98"></a>
<code>__xstrdup(const char *s, const char *file, int line, const char *function, const char *var)</code></h3>
<ul>
<li>Duplicates string with tracking</li>
<li>Usage: <code>char *copy = XSTRDUP(original, "copy");</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md99"></a>
<code>__xstrndup(const char *s, size_t n, ...)</code></h3>
<ul>
<li>Duplicates at most n bytes of string</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md101"></a>
Printf Variants</h2>
<h3><a class="anchor" id="autotoc_md102"></a>
<code>__xsprintf(char *str, const char *format, ...)</code></h3>
<ul>
<li>Printf to buffer with overflow protection</li>
<li>If buffer is tracked: output limited to buffer size</li>
<li>Returns bytes written</li>
</ul>
<h3><a class="anchor" id="autotoc_md103"></a>
<code>__xsnprintf(char *str, size_t size, const char *format, ...)</code></h3>
<ul>
<li>Printf with explicit size limit and overflow protection</li>
</ul>
<h3><a class="anchor" id="autotoc_md104"></a>
<code>__xsprintfcat(char *str, const char *format, ...)</code></h3>
<ul>
<li>Printf-append: appends formatted output to end of string</li>
</ul>
<h3><a class="anchor" id="autotoc_md105"></a>
<code>__xsafesprintf(char *buff, char **bufp, const char *format, ...)</code></h3>
<ul>
<li>Printf to tracked buffer with pointer advancement</li>
<li><b>Usage pattern:</b> <div class="fragment"><div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(<a class="code hl_define" href="constants_8h.html#a5f9bfff70bfa4747437d8320ccfa045a">LBUF_SIZE</a>, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line"><span class="keywordtype">char</span> *bp = buffer;</div>
<div class="line"> </div>
<div class="line">SAFE_SPRINTF(buffer, &amp;bp, <span class="stringliteral">&quot;Line 1\n&quot;</span>);</div>
<div class="line">SAFE_SPRINTF(buffer, &amp;bp, <span class="stringliteral">&quot;Line 2\n&quot;</span>);</div>
<div class="line">SAFE_SPRINTF(buffer, &amp;bp, <span class="stringliteral">&quot;Line 3\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a>(player, buffer);</div>
<div class="line">XFREE(buffer);</div>
<div class="ttc" id="aconstants_8h_html_a5f9bfff70bfa4747437d8320ccfa045a"><div class="ttname"><a href="constants_8h.html#a5f9bfff70bfa4747437d8320ccfa045a">LBUF_SIZE</a></div><div class="ttdeci">#define LBUF_SIZE</div><div class="ttdef"><b>Definition</b> constants.h:18</div></div>
<div class="ttc" id="amacros_8h_html_abe044d79896c3d56e758f742f4765f61"><div class="ttname"><a href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a></div><div class="ttdeci">#define notify(p, m,...)</div><div class="ttdef"><b>Definition</b> macros.h:226</div></div>
</div><!-- fragment --></li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md107"></a>
Memory Operations</h2>
<h3><a class="anchor" id="autotoc_md108"></a>
<code>__xmemmove(void *dest, const void *src, size_t n)</code></h3>
<ul>
<li>Overlapping-safe memory copy with bounds checking</li>
</ul>
<h3><a class="anchor" id="autotoc_md109"></a>
<code>__xmempcpy(void *dest, const void *src, size_t n)</code></h3>
<ul>
<li>Memory copy that returns pointer to end of copied region</li>
</ul>
<h3><a class="anchor" id="autotoc_md110"></a>
<code>__xmemccpy(void *dest, const void *src, int c, size_t n)</code></h3>
<ul>
<li>Copy until character c is found, with bounds checking</li>
</ul>
<h3><a class="anchor" id="autotoc_md111"></a>
<code>__xmemset(void *s, int c, size_t n)</code></h3>
<ul>
<li>Fill memory with character, respecting buffer bounds</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md113"></a>
Safe Buffer Operations</h1>
<h2><a class="anchor" id="autotoc_md114"></a>
<code>__xsafestrncpy(char *dest, char **destp, const char *src, size_t n, size_t size)</code></h2>
<p><b>Purpose:</b> Copy with pointer tracking and overflow prevention</p>
<p><b>Parameters:</b></p><ul>
<li><code>dest</code>: Destination buffer</li>
<li><code>destp</code>: Pointer-to-pointer tracking current position</li>
<li><code>src</code>: Source string</li>
<li><code>n</code>: Maximum bytes to copy</li>
<li><code>size</code>: Buffer size (if untracked)</li>
</ul>
<p><b>Returns:</b> Number of bytes from src that didn't fit</p>
<p><b>Typical Usage:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(<a class="code hl_define" href="constants_8h.html#a5f9bfff70bfa4747437d8320ccfa045a">LBUF_SIZE</a>, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line"><span class="keywordtype">char</span> *bp = buffer;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="alloc_8c.html#adbbf8898a2d02a4dff693747bf9bc058">__xsafestrncpy</a>(buffer, &amp;bp, <span class="stringliteral">&quot;Hello &quot;</span>, 6, <a class="code hl_define" href="constants_8h.html#a5f9bfff70bfa4747437d8320ccfa045a">LBUF_SIZE</a>);</div>
<div class="line"><a class="code hl_function" href="alloc_8c.html#adbbf8898a2d02a4dff693747bf9bc058">__xsafestrncpy</a>(buffer, &amp;bp, <span class="stringliteral">&quot;World!&quot;</span>, 6, <a class="code hl_define" href="constants_8h.html#a5f9bfff70bfa4747437d8320ccfa045a">LBUF_SIZE</a>);</div>
<div class="line"><span class="comment">// buffer now contains: &quot;Hello World!&quot;</span></div>
<div class="line"><span class="comment">// bp points to end position</span></div>
<div class="line">XFREE(buffer);</div>
<div class="ttc" id="aalloc_8c_html_adbbf8898a2d02a4dff693747bf9bc058"><div class="ttname"><a href="alloc_8c.html#adbbf8898a2d02a4dff693747bf9bc058">__xsafestrncpy</a></div><div class="ttdeci">size_t __xsafestrncpy(char *dest, char **destp, const char *src, size_t n, size_t size)</div><div class="ttdoc">Copy a string with at most n character from src and update the position pointer to the end of the des...</div><div class="ttdef"><b>Definition</b> alloc.c:1405</div></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md116"></a>
<code>__xsafestrncat(char *dest, char **destp, const char *src, size_t n, size_t size)</code></h2>
<p><b>Purpose:</b> Append with pointer tracking and bounds checking</p>
<p><b>Returns:</b> Number of bytes from src that didn't fit</p>
<hr  />
<h2><a class="anchor" id="autotoc_md118"></a>
<code>__xsafestrcatchr(char *dest, char **destp, char c, size_t size)</code></h2>
<p><b>Purpose:</b> Append single character with pointer tracking</p>
<p><b>Parameters:</b></p><ul>
<li><code>dest</code>: Destination buffer</li>
<li><code>destp</code>: Pointer-to-pointer tracking position</li>
<li><code>c</code>: Character to append</li>
<li><code>size</code>: Buffer size (if untracked)</li>
</ul>
<p><b>Returns:</b> 0 on success, 1 if buffer full</p>
<hr  />
<h1><a class="anchor" id="autotoc_md120"></a>
Statistics and Debugging</h1>
<h2><a class="anchor" id="autotoc_md121"></a>
<code>list_rawmemory(dbref player)</code></h2>
<p><b>Purpose:</b> Display memory allocation statistics to player</p>
<p><b>Output Format:</b> </p><div class="fragment"><div class="line">File              Line Function            Variable             Allocs    Bytes</div>
<div class="line">--------------- ------ ------------------- -------------------- ------ --------</div>
<div class="line">predicates.c     2156   do_prog             program              1       512</div>
<div class="line">commands.c       897    do_command          cmd_line             4       2.5K</div>
<div class="line">...</div>
<div class="line">Total: 234 raw allocations in 45 unique tags, 512.3K bytes used.</div>
</div><!-- fragment --><p><b>Usage:</b> </p><div class="fragment"><div class="line">@list raw_memory      (In-game command)</div>
</div><!-- fragment --><p><b>Caution:</b> Can cause lag on large muds with many allocations.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md123"></a>
<code>total_rawmemory(void)</code></h2>
<p><b>Purpose:</b> Calculate total bytes currently allocated</p>
<p><b>Returns:</b> Total memory in bytes across all tracked allocations</p>
<hr  />
<h1><a class="anchor" id="autotoc_md125"></a>
Macro Wrappers</h1>
<h2><a class="anchor" id="autotoc_md126"></a>
Standard Allocation Macros</h2>
<p>All X* functions have macro wrappers that automatically provide <code>__FILE__</code>, <code>__LINE__</code>, and <code>__func__</code>:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(size, <span class="stringliteral">&quot;variable_name&quot;</span>)</div>
<div class="line">XCALLOC(nmemb, size, &quot;variable_name&quot;)</div>
<div class="line">XREALLOC(ptr, size, &quot;variable_name&quot;)</div>
<div class="line">XFREE(ptr)</div>
<div class="line"> </div>
<div class="line">XSTRDUP(str, &quot;variable_name&quot;)</div>
<div class="line">XSTRNDUP(str, n, &quot;variable_name&quot;)</div>
<div class="line"> </div>
<div class="line">XASPRINTF(&quot;variable_name&quot;, &quot;format&quot;, ...)</div>
<div class="line">XAVSPRINTF(&quot;variable_name&quot;, &quot;format&quot;, va_list)</div>
<div class="line"> </div>
<div class="line">XSPRINTF(str, &quot;format&quot;, ...)</div>
<div class="line">XSNPRINTF(str, size, &quot;format&quot;, ...)</div>
<div class="line">XSPRINTFCAT(str, &quot;format&quot;, ...)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md127"></a>
Safe Buffer Macros</h2>
<p>Used for safe pointer-advancing buffer operations:</p>
<div class="fragment"><div class="line">SAFE_STRNCPY(dest, destp, src, n, size)</div>
<div class="line">SAFE_STRNCAT(dest, destp, src, n, size)</div>
<div class="line">SAFE_SPRINTF(dest, destp, <span class="stringliteral">&quot;format&quot;</span>, ...)</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md129"></a>
Common Patterns</h1>
<h2><a class="anchor" id="autotoc_md130"></a>
Pattern 1: Dynamic String Building</h2>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(<a class="code hl_define" href="constants_8h.html#a5f9bfff70bfa4747437d8320ccfa045a">LBUF_SIZE</a>, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line"><span class="keywordtype">char</span> *bp = buffer;</div>
<div class="line"> </div>
<div class="line">SAFE_SPRINTF(buffer, &amp;bp, <span class="stringliteral">&quot;Name: %s\n&quot;</span>, player_name);</div>
<div class="line">SAFE_SPRINTF(buffer, &amp;bp, <span class="stringliteral">&quot;Level: %d\n&quot;</span>, player_level);</div>
<div class="line">SAFE_SPRINTF(buffer, &amp;bp, <span class="stringliteral">&quot;Status: %s\n&quot;</span>, player_status);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a>(player, buffer);</div>
<div class="line">XFREE(buffer);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md131"></a>
Pattern 2: Array Allocation with Overflow Check</h2>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (count &gt; SIZE_MAX / <span class="keyword">sizeof</span>(OBJECT*)) {</div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a>(player, <span class="stringliteral">&quot;Count too large!&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">OBJECT **array = XCALLOC(count, <span class="keyword">sizeof</span>(OBJECT*), <span class="stringliteral">&quot;object_array&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!array) {</div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a>(player, <span class="stringliteral">&quot;Memory allocation failed!&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use array...</span></div>
<div class="line"> </div>
<div class="line">XFREE(array);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md132"></a>
Pattern 3: Safe String Duplication</h2>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> *original = <span class="stringliteral">&quot;Important Data&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> *copy = XSTRDUP(original, <span class="stringliteral">&quot;copy&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (!copy) {</div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a>(player, <span class="stringliteral">&quot;Memory allocation failed!&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Modify copy without affecting original...</span></div>
<div class="line"> </div>
<div class="line">XFREE(copy);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md133"></a>
Pattern 4: Buffer Overflow Detection</h2>
<div class="fragment"><div class="line"><span class="comment">// During debug/testing</span></div>
<div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="alloc_8c.html#a6fb3e6eacbda5141d4aa7c2fb0ec048b">__xcheck</a>(buffer);</div>
<div class="line"><span class="keywordflow">if</span> (status == 0) {</div>
<div class="line">    <span class="comment">// CRITICAL: Buffer was overrun!</span></div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a>(<a class="code hl_define" href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a>, <span class="stringliteral">&quot;BUG&quot;</span>, <span class="stringliteral">&quot;OVERRUN&quot;</span>, </div>
<div class="line">              <span class="stringliteral">&quot;Buffer overflow detected at %p&quot;</span>, buffer);</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md135"></a>
Configuration</h1>
<h2><a class="anchor" id="autotoc_md136"></a>
Memory Logging</h2>
<p>Enable memory allocation logging via configuration:</p>
<div class="fragment"><div class="line">mushconf.<a class="code hl_variable" href="structconfdata.html#a5241bab417873b6d368b4aa93bca95a5">malloc_logger</a> = 1;  <span class="comment">// Enable logging</span></div>
<div class="line">mushconf.<a class="code hl_variable" href="structconfdata.html#a5241bab417873b6d368b4aa93bca95a5">malloc_logger</a> = 0;  <span class="comment">// Disable logging</span></div>
<div class="ttc" id="astructconfdata_html_a5241bab417873b6d368b4aa93bca95a5"><div class="ttname"><a href="structconfdata.html#a5241bab417873b6d368b4aa93bca95a5">confdata::malloc_logger</a></div><div class="ttdeci">int malloc_logger</div><div class="ttdef"><b>Definition</b> typedefs.h:1002</div></div>
</div><!-- fragment --><p>When enabled, allocations/deallocations are logged to: </p><div class="fragment"><div class="line">LOG_MALLOC facility with format:</div>
<div class="line">Alloc: file[line]function:variable Alloc N bytes</div>
<div class="line">Free:  file[line]function:variable Free N bytes</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md138"></a>
Performance Considerations</h1>
<h2><a class="anchor" id="autotoc_md139"></a>
Overhead</h2>
<ul>
<li><b>Per-allocation overhead:</b> <code>sizeof(MEMTRACK) + 8 bytes</code> (magic number)<ul>
<li>Typically 64-80 bytes on 64-bit systems</li>
</ul>
</li>
<li><b>Lookup time:</b> O(n) where n = number of active allocations<ul>
<li>For buffer bounds checking on every sprintf/strcpy call</li>
<li>Cache-friendly due to linked list traversal</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md140"></a>
Optimization Tips</h2>
<ol type="1">
<li><b>Minimize realloc() calls:</b> Pre-allocate with expected size</li>
<li><b>Batch operations:</b> Combine multiple sprintf calls before notify</li>
<li><b>Reuse buffers:</b> When possible, reuse allocated buffers instead of freeing/reallocating</li>
<li><b>Profile:</b> Use <code>@list raw_memory</code> to identify hot allocation sites</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md142"></a>
Error Handling</h1>
<h2><a class="anchor" id="autotoc_md143"></a>
Allocation Failures</h2>
<p>All X* functions return NULL on failure. Always check:</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(size, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!buffer) {</div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a>(<a class="code hl_define" href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a>, <span class="stringliteral">&quot;MEM&quot;</span>, <span class="stringliteral">&quot;ERROR&quot;</span>, </div>
<div class="line">              <span class="stringliteral">&quot;Failed to allocate %zu bytes&quot;</span>, size);</div>
<div class="line">    <span class="keywordflow">return</span>; <span class="comment">// or error handling</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md144"></a>
Buffer Overruns</h2>
<p>Detected at free time via magic number. Action:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="alloc_8c.html#adc770c55d160860dca77d400a7349421">__xfree</a>(buffer)) {</div>
<div class="line">    <span class="comment">// Buffer was overrun - investigate caller</span></div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a>(<a class="code hl_define" href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a>, <span class="stringliteral">&quot;MEM&quot;</span>, <span class="stringliteral">&quot;OVERRUN&quot;</span>,</div>
<div class="line">              <span class="stringliteral">&quot;Stack trace: %s&quot;</span>, stack_trace());</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md145"></a>
Integer Overflow</h2>
<p>Only in <code>__xcalloc</code>. Always handle:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> *result = XCALLOC(user_rows, user_cols, <span class="stringliteral">&quot;matrix&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Could be overflow or true OOM</span></div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a>(<a class="code hl_define" href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a>, <span class="stringliteral">&quot;MEM&quot;</span>, <span class="stringliteral">&quot;ERROR&quot;</span>,</div>
<div class="line">              <span class="stringliteral">&quot;XCALLOC(%zu, %zu) failed - possible overflow&quot;</span>,</div>
<div class="line">              user_rows, user_cols);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md147"></a>
Security Implications</h1>
<h2><a class="anchor" id="autotoc_md148"></a>
Buffer Overflow Protection</h2>
<p>The magic number system detects overwrites <b>after</b> they occur, not during. Never rely on this for security:</p>
<div class="fragment"><div class="line"><span class="comment">// BAD - exploitable:</span></div>
<div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(10, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line">strcpy(buffer, user_input);  <span class="comment">// User input &gt; 10 bytes?</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// GOOD - safe:</span></div>
<div class="line"><span class="keywordtype">char</span> *buffer = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(MAX_USER_INPUT, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line">strncpy(buffer, user_input, MAX_USER_INPUT - 1);</div>
<div class="line">buffer[MAX_USER_INPUT - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md149"></a>
Integer Overflow Protection</h2>
<p>Only <code>XCALLOC</code> checks for overflow. Manual calculations must be validated:</p>
<div class="fragment"><div class="line"><span class="comment">// BAD:</span></div>
<div class="line"><span class="keywordtype">size_t</span> total = rows * cols;  <span class="comment">// Could overflow</span></div>
<div class="line"><span class="keywordtype">char</span> *matrix = <a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>(total, <span class="stringliteral">&quot;matrix&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// GOOD:</span></div>
<div class="line"><span class="keywordflow">if</span> (rows &gt; SIZE_MAX / cols) {</div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a>(player, <span class="stringliteral">&quot;Size too large!&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">char</span> *matrix = XCALLOC(rows, cols, <span class="stringliteral">&quot;matrix&quot;</span>);</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md151"></a>
Debugging Tips</h1>
<h2><a class="anchor" id="autotoc_md152"></a>
Find Allocation Source</h2>
<div class="fragment"><div class="line">MEMTRACK *info = <a class="code hl_function" href="alloc_8c.html#a39788016153b54df3b35aefa562b9e6d">__xfind</a>(pointer);</div>
<div class="line"><span class="keywordflow">if</span> (info) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Allocated: %s:%d %s() var=%s size=%zu\n&quot;</span>,</div>
<div class="line">           info-&gt;file, info-&gt;line, info-&gt;function, </div>
<div class="line">           info-&gt;var, info-&gt;size);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md153"></a>
Trace All Allocations</h2>
<p>Enable malloc_logger and grep logs: </p><div class="fragment"><div class="line">grep &quot;MEM.*TRACE&quot; game.log | grep &quot;allocation_site&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md154"></a>
Memory Leak Detection</h2>
<div class="fragment"><div class="line"><a class="code hl_function" href="alloc_8c.html#a29f3880a920752ac225497297ccbdf4a">list_rawmemory</a>(player);</div>
<div class="line"><span class="comment">// Check if size grows unexpectedly over time</span></div>
<div class="line"><span class="comment">// Compare @list raw_memory output periodically</span></div>
<div class="ttc" id="aalloc_8c_html_a29f3880a920752ac225497297ccbdf4a"><div class="ttname"><a href="alloc_8c.html#a29f3880a920752ac225497297ccbdf4a">list_rawmemory</a></div><div class="ttdeci">void list_rawmemory(dbref player)</div><div class="ttdoc">Show to the player a summary of all allocations.</div><div class="ttdef"><b>Definition</b> alloc.c:1243</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md156"></a>
API Reference Summary</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function   </th><th class="markdownTableHeadNone">Purpose   </th><th class="markdownTableHeadNone">Safe?    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>XMALLOC</code>   </td><td class="markdownTableBodyNone">Allocate &amp; zero   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>XCALLOC</code>   </td><td class="markdownTableBodyNone">Array allocate with overflow check   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>XREALLOC</code>   </td><td class="markdownTableBodyNone">Resize allocation   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>XFREE</code>   </td><td class="markdownTableBodyNone">Free with overrun detection   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>XSTRDUP</code>   </td><td class="markdownTableBodyNone">Duplicate string   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>XASPRINTF</code>   </td><td class="markdownTableBodyNone">Formatted string allocation   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>XSPRINTF</code>   </td><td class="markdownTableBodyNone">Printf to buffer (bounded)   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>XSTRCAT</code>   </td><td class="markdownTableBodyNone">Append string (bounded)   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SAFE_SPRINTF</code>   </td><td class="markdownTableBodyNone">Printf with pointer tracking   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SAFE_STRNCPY</code>   </td><td class="markdownTableBodyNone">Copy with pointer tracking   </td><td class="markdownTableBodyNone">Yes   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md158"></a>
Version Information</h1>
<ul>
<li><b>File:</b> <code><a class="el" href="alloc_8c.html" title="Tracked memory allocation, leak detection, and buffer safety helpers.">netmush/alloc.c</a></code></li>
<li><b>Version:</b> Part of TinyMUSH 4.x</li>
<li><b>License:</b> Artistic License (see COPYING)</li>
<li><b>Compiled:</b> With C11 support when available </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
