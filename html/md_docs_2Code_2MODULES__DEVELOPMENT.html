<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TinyMUSH: Module Development Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TinyMUSH<span id="projectnumber">&#160;3.3</span>
   </div>
   <div id="projectbrief">TinyMUSH Server</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Module Development Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md182"></a></p>
<p>TinyMUSH 4.0 provides a module system that allows developers to extend server functionality through dynamically loadable modules. This document covers module development, architecture, and best practices.</p>
<h1><a class="anchor" id="autotoc_md183"></a>
Table of Contents</h1>
<ul>
<li>Overview</li>
<li>Module Architecture</li>
<li>Building a Module</li>
<li>Module Structure</li>
<li>Module Initialization</li>
<li>Configuration Management</li>
<li>Example Modules</li>
<li>Best Practices</li>
</ul>
<h1><a class="anchor" id="autotoc_md184"></a>
Overview</h1>
<p>Modules are compiled C code that extends TinyMUSH without modifying the core server. This approach allows:</p>
<ul>
<li><b>Upgradability</b>: Core updates don't affect module code</li>
<li><b>Modularity</b>: Features can be toggled on/off via configuration</li>
<li><b>Performance</b>: Hardcoded functionality vs. softcode</li>
<li><b>Extensibility</b>: Add new commands, functions, and behaviors</li>
</ul>
<h2><a class="anchor" id="autotoc_md185"></a>
Module Safety Considerations</h2>
<p>Modules have direct access to server internals and operate without the safety guarantees of softcode. Therefore:</p>
<ul>
<li><b>Stability</b>: Buggy modules can crash or corrupt the database</li>
<li><b>Responsibility</b>: Module authors must thoroughly test their code</li>
<li><b>Documentation</b>: Ensure clear documentation of module behavior and dependencies</li>
</ul>
<h1><a class="anchor" id="autotoc_md186"></a>
Module Architecture</h1>
<p>Each module consists of:</p>
<ol type="1">
<li><b>Source code</b> - C implementation in <code>src/modules/&lt;name&gt;/</code></li>
<li><b>Header files</b> - Interface definitions</li>
<li><b>Build configuration</b> - <code>configure.in</code> and <code>Makefile.inc.in</code></li>
<li><b>Compiled artifact</b> - <code>.so</code> file loaded at startup</li>
</ol>
<h2><a class="anchor" id="autotoc_md187"></a>
Module Entry Points</h2>
<p>Every module must define:</p>
<ul>
<li><b>Initialization function</b>: <code>void mod_&lt;name&gt;_init()</code> - called at server startup</li>
<li><b>Configuration table</b>: <code>CONF mod_&lt;name&gt;_conftable[]</code> - defines config parameters</li>
<li><b>Version info</b>: <code>MODVER mod_&lt;name&gt;_version</code> - version metadata</li>
</ul>
<h1><a class="anchor" id="autotoc_md188"></a>
Building a Module</h1>
<h2><a class="anchor" id="autotoc_md189"></a>
1. Directory Structure (CMake-only)</h2>
<div class="fragment"><div class="line">src/modules/&lt;name&gt;/</div>
<div class="line">├── CMakeLists.txt</div>
<div class="line">├── &lt;name&gt;.c</div>
<div class="line">└── &lt;name&gt;.h</div>
</div><!-- fragment --><p>Start from the provided skeleton template:</p>
<div class="fragment"><div class="line">cp -r src/modules/skeleton src/modules/mymodule</div>
<div class="line">cd src/modules/mymodule</div>
<div class="line">mv skeleton.c mymodule.c</div>
<div class="line">mv skeleton.h mymodule.h</div>
<div class="line">sed -i &#39;s/skeleton/mymodule/g&#39; mymodule.c mymodule.h CMakeLists.txt</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md190"></a>
2. Build and Install</h2>
<div class="fragment"><div class="line">cd /home/eddy/source/TinyMUSH</div>
<div class="line">mkdir -p build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>Artifacts land in <code>build/modules/</code>; <code>make install</code> or the <code>install-upgrade</code> target copies them to <code>game/modules/</code>.</p>
<h2><a class="anchor" id="autotoc_md191"></a>
3. Enable/Disable Modules</h2>
<ul>
<li>Add or remove module subdirectories in <code>modules.cmake</code> (leave uncommented to build, comment out to skip).</li>
<li>In <code>game/configs/netmush.conf</code>, list modules to load at runtime:</li>
</ul>
<div class="fragment"><div class="line">module mymodule</div>
</div><!-- fragment --><p>Modules load on server start; restart after changing the list.</p>
<h1><a class="anchor" id="autotoc_md192"></a>
Module Structure</h1>
<h2><a class="anchor" id="autotoc_md193"></a>
Header Template</h2>
<p>Include the standard server headers plus your own module header:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;config.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="constants_8h.html">constants.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="typedefs_8h.html">typedefs.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="macros_8h.html">macros.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="externs_8h.html">externs.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;prototypes.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;mymodule.h&quot;</span></div>
<div class="ttc" id="aconstants_8h_html"><div class="ttname"><a href="constants_8h.html">constants.h</a></div><div class="ttdoc">Global numeric and string constants for flags, limits, and parser tokens.</div></div>
<div class="ttc" id="aexterns_8h_html"><div class="ttname"><a href="externs_8h.html">externs.h</a></div><div class="ttdoc">Shared extern declarations and globals used across the game engine.</div></div>
<div class="ttc" id="amacros_8h_html"><div class="ttname"><a href="macros_8h.html">macros.h</a></div><div class="ttdoc">Engine-wide macros for memory tracking, flag checks, logging, and utilities.</div></div>
<div class="ttc" id="atypedefs_8h_html"><div class="ttname"><a href="typedefs_8h.html">typedefs.h</a></div><div class="ttdoc">Core typedefs for dbrefs, flags, buffers, and engine data structures.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md194"></a>
Namespace Conventions</h2>
<p>Avoid symbol collisions by prefixing:</p>
<ul>
<li><b>Functions</b>: <code>mod_&lt;name&gt;_&lt;function_name&gt;()</code></li>
<li><b>Variables</b>: <code>mod_&lt;name&gt;_&lt;variable_name&gt;</code></li>
<li><b>Macros</b>: <code>MOD_&lt;NAME&gt;_&lt;CONSTANT_NAME&gt;</code></li>
<li><b>Structures</b>: <code>struct mod_&lt;name&gt;_&lt;structure_name&gt;</code></li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> mod_mail_send_message(dbref player, <span class="keyword">const</span> <span class="keywordtype">char</span> *recipient);</div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structmod__mail__confstorage.html">mod_mail_confstorage</a> mod_mail_config;</div>
<div class="line"><span class="preprocessor">#define MOD_MAIL_MAX_MSG_SIZE 4096</span></div>
<div class="ttc" id="astructmod__mail__confstorage_html"><div class="ttname"><a href="structmod__mail__confstorage.html">mod_mail_confstorage</a></div><div class="ttdef"><b>Definition</b> mail.c:89</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md195"></a>
Module Initialization</h1>
<h2><a class="anchor" id="autotoc_md196"></a>
Configuration Storage</h2>
<p>Skeleton baseline:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>mod_&lt;name&gt;_confstorage {</div>
<div class="line">    <span class="keywordtype">int</span> enabled;</div>
<div class="line">} mod_&lt;name&gt;_config;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md197"></a>
Configuration Table</h2>
<p>Map config directives to fields:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structconfparm.html">CONF</a> mod_&lt;name&gt;_conftable[] = {</div>
<div class="line">    {(<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;&lt;name&gt;_enabled&quot;</span>, <a class="code hl_function" href="conf_8c.html#a3637eed82e0dc8a7aca3d536208a691a">cf_bool</a>, <a class="code hl_define" href="constants_8h.html#ae3711c84b4ca88296796e8af4df161e2">CA_GOD</a>, <a class="code hl_define" href="constants_8h.html#ac83d7116eca40585f086d0c0c5e02e0c">CA_PUBLIC</a>,</div>
<div class="line">     &amp;mod_&lt;name&gt;_config.enabled, (<span class="keywordtype">long</span>)<span class="stringliteral">&quot;Enable module&quot;</span>},</div>
<div class="line">    {NULL, NULL, 0, 0, NULL, 0}</div>
<div class="line">};</div>
<div class="ttc" id="aconf_8c_html_a3637eed82e0dc8a7aca3d536208a691a"><div class="ttname"><a href="conf_8c.html#a3637eed82e0dc8a7aca3d536208a691a">cf_bool</a></div><div class="ttdeci">CF_Result cf_bool(int *vp, char *str, long extra __attribute__((unused)), dbref player __attribute__((unused)), char *cmd __attribute__((unused)))</div><div class="ttdoc">Set boolean parameter.</div><div class="ttdef"><b>Definition</b> conf.c:785</div></div>
<div class="ttc" id="aconstants_8h_html_ac83d7116eca40585f086d0c0c5e02e0c"><div class="ttname"><a href="constants_8h.html#ac83d7116eca40585f086d0c0c5e02e0c">CA_PUBLIC</a></div><div class="ttdeci">#define CA_PUBLIC</div><div class="ttdoc">Command permission flags.</div><div class="ttdef"><b>Definition</b> constants.h:379</div></div>
<div class="ttc" id="aconstants_8h_html_ae3711c84b4ca88296796e8af4df161e2"><div class="ttname"><a href="constants_8h.html#ae3711c84b4ca88296796e8af4df161e2">CA_GOD</a></div><div class="ttdeci">#define CA_GOD</div><div class="ttdef"><b>Definition</b> constants.h:380</div></div>
<div class="ttc" id="astructconfparm_html"><div class="ttname"><a href="structconfparm.html">confparm</a></div><div class="ttdef"><b>Definition</b> typedefs.h:775</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md198"></a>
Initialization Function</h2>
<p>Called at server startup; register tables and init hashes:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> mod_&lt;name&gt;_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    mod_&lt;name&gt;_config.enabled = 1;</div>
<div class="line"> </div>
<div class="line">    hashinit(&amp;mod_&lt;name&gt;_data_htab, 100, <a class="code hl_define" href="constants_8h.html#a1056b6e6b9cb73a581fe3ba3e3ca3548">HT_KEYREF</a> | <a class="code hl_define" href="constants_8h.html#afb416e2446a6769c9c843925dd553eef">HT_STR</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="api_8c.html#ae5bb1b336c21c7e64ea8c77141ef7673">register_commands</a>(mod_&lt;name&gt;_cmdtable);</div>
<div class="line">    <a class="code hl_function" href="api_8c.html#a3e28939ab772d85f2ce15d7499908871">register_functions</a>(mod_&lt;name&gt;_functable);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a>(<a class="code hl_define" href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a>, <span class="stringliteral">&quot;MOD&quot;</span>, <span class="stringliteral">&quot;XXXX&quot;</span>, <span class="stringliteral">&quot;Module &lt;NAME&gt; initialized&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="aapi_8c_html_a3e28939ab772d85f2ce15d7499908871"><div class="ttname"><a href="api_8c.html#a3e28939ab772d85f2ce15d7499908871">register_functions</a></div><div class="ttdeci">void register_functions(FUN *functab)</div><div class="ttdoc">Register module's functions with the main functions handler.</div><div class="ttdef"><b>Definition</b> api.c:147</div></div>
<div class="ttc" id="aapi_8c_html_ae5bb1b336c21c7e64ea8c77141ef7673"><div class="ttname"><a href="api_8c.html#ae5bb1b336c21c7e64ea8c77141ef7673">register_commands</a></div><div class="ttdeci">void register_commands(CMDENT *cmdtab)</div><div class="ttdoc">Register module's commands with the main command handler.</div><div class="ttdef"><b>Definition</b> api.c:104</div></div>
<div class="ttc" id="aconstants_8h_html_a1056b6e6b9cb73a581fe3ba3e3ca3548"><div class="ttname"><a href="constants_8h.html#a1056b6e6b9cb73a581fe3ba3e3ca3548">HT_KEYREF</a></div><div class="ttdeci">#define HT_KEYREF</div><div class="ttdef"><b>Definition</b> constants.h:1350</div></div>
<div class="ttc" id="aconstants_8h_html_a70f52cf948e57d4338de17a52f8e1a0a"><div class="ttname"><a href="constants_8h.html#a70f52cf948e57d4338de17a52f8e1a0a">LOG_ALWAYS</a></div><div class="ttdeci">#define LOG_ALWAYS</div><div class="ttdef"><b>Definition</b> constants.h:1469</div></div>
<div class="ttc" id="aconstants_8h_html_afb416e2446a6769c9c843925dd553eef"><div class="ttname"><a href="constants_8h.html#afb416e2446a6769c9c843925dd553eef">HT_STR</a></div><div class="ttdeci">#define HT_STR</div><div class="ttdef"><b>Definition</b> constants.h:1347</div></div>
<div class="ttc" id="amacros_8h_html_adba1624513b5ccddfc8bc0831f9cbf45"><div class="ttname"><a href="macros_8h.html#adba1624513b5ccddfc8bc0831f9cbf45">log_write</a></div><div class="ttdeci">#define log_write(i, p, s, f,...)</div><div class="ttdoc">Log related macros.</div><div class="ttdef"><b>Definition</b> macros.h:220</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md199"></a>
Configuration Management</h1>
<h2><a class="anchor" id="autotoc_md200"></a>
Boolean Parameters</h2>
<div class="fragment"><div class="line">{(<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;mymodule_enabled&quot;</span>, <a class="code hl_function" href="conf_8c.html#a3637eed82e0dc8a7aca3d536208a691a">cf_bool</a>, <a class="code hl_define" href="constants_8h.html#ae3711c84b4ca88296796e8af4df161e2">CA_GOD</a>, <a class="code hl_define" href="constants_8h.html#ac83d7116eca40585f086d0c0c5e02e0c">CA_PUBLIC</a>,</div>
<div class="line"> &amp;mod_mymodule_config.enabled, (<span class="keywordtype">long</span>)<span class="stringliteral">&quot;Enable module&quot;</span>}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md201"></a>
Integer / String / Const Patterns</h2>
<div class="fragment"><div class="line">{(<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;mymodule_limit&quot;</span>, <a class="code hl_function" href="conf_8c.html#a9a1ad9bd03ddc49a2e5e5d64ecfcbd7a">cf_int</a>, <a class="code hl_define" href="constants_8h.html#ae3711c84b4ca88296796e8af4df161e2">CA_GOD</a>, <a class="code hl_define" href="constants_8h.html#ac83d7116eca40585f086d0c0c5e02e0c">CA_PUBLIC</a>,</div>
<div class="line"> &amp;mod_mymodule_config.limit, 1000}</div>
<div class="line"> </div>
<div class="line">{(<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;mymodule_label&quot;</span>, <a class="code hl_function" href="conf_8c.html#ad234822432f9ec1ea18767b51d4e498b">cf_string</a>, <a class="code hl_define" href="constants_8h.html#ae3711c84b4ca88296796e8af4df161e2">CA_GOD</a>, <a class="code hl_define" href="constants_8h.html#ac83d7116eca40585f086d0c0c5e02e0c">CA_PUBLIC</a>,</div>
<div class="line"> (<span class="keywordtype">int</span> *)&amp;mod_mymodule_config.label, 128}</div>
<div class="line"> </div>
<div class="line">{(<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;mymodule_version&quot;</span>, <a class="code hl_function" href="conf_8c.html#aa780cef79c1cef85acf4b459d72f283b">cf_const</a>, <a class="code hl_define" href="constants_8h.html#a78303ca1278b01d81c88f7855dd2cb24">CA_STATIC</a>, <a class="code hl_define" href="constants_8h.html#ac83d7116eca40585f086d0c0c5e02e0c">CA_PUBLIC</a>,</div>
<div class="line"> &amp;mod_mymodule_version.version, (<span class="keywordtype">long</span>)<span class="stringliteral">&quot;1.0.0&quot;</span>}</div>
<div class="ttc" id="aconf_8c_html_a9a1ad9bd03ddc49a2e5e5d64ecfcbd7a"><div class="ttname"><a href="conf_8c.html#a9a1ad9bd03ddc49a2e5e5d64ecfcbd7a">cf_int</a></div><div class="ttdeci">CF_Result cf_int(int *vp, char *str, long extra, dbref player, char *cmd)</div><div class="ttdoc">Set integer parameter.</div><div class="ttdef"><b>Definition</b> conf.c:487</div></div>
<div class="ttc" id="aconf_8c_html_aa780cef79c1cef85acf4b459d72f283b"><div class="ttname"><a href="conf_8c.html#aa780cef79c1cef85acf4b459d72f283b">cf_const</a></div><div class="ttdeci">CF_Result cf_const(int *vp __attribute__((unused)), char *str __attribute__((unused)), long extra __attribute__((unused)), dbref player, char *cmd)</div><div class="ttdoc">Read-only integer or boolean parameter.</div><div class="ttdef"><b>Definition</b> conf.c:467</div></div>
<div class="ttc" id="aconf_8c_html_ad234822432f9ec1ea18767b51d4e498b"><div class="ttname"><a href="conf_8c.html#ad234822432f9ec1ea18767b51d4e498b">cf_string</a></div><div class="ttdeci">CF_Result cf_string(int *vp, char *str, long extra, dbref player, char *cmd)</div><div class="ttdoc">Set string parameter.</div><div class="ttdef"><b>Definition</b> conf.c:831</div></div>
<div class="ttc" id="aconstants_8h_html_a78303ca1278b01d81c88f7855dd2cb24"><div class="ttname"><a href="constants_8h.html#a78303ca1278b01d81c88f7855dd2cb24">CA_STATIC</a></div><div class="ttdeci">#define CA_STATIC</div><div class="ttdef"><b>Definition</b> constants.h:415</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md202"></a>
Example Modules</h1>
<h2><a class="anchor" id="autotoc_md203"></a>
Mail Module</h2>
<p>Location: <code>src/modules/mail/</code></p>
<p><b>Features</b>:</p><ul>
<li>In-game mail delivery system</li>
<li>Mailbox management</li>
<li>Mail aliases</li>
<li>PennMUSH-compatible syntax</li>
</ul>
<p><b>Configuration</b>:</p><ul>
<li><code>mail_expiration</code>: Days before mail is deleted</li>
<li><code>mail_database</code>: Database file location</li>
</ul>
<p><b>Key Functions</b>:</p><ul>
<li><code>@mail</code> - Send and manage messages</li>
<li><code>@malias</code> - Create mail aliases</li>
</ul>
<h2><a class="anchor" id="autotoc_md204"></a>
Comsys Module</h2>
<p>Location: <code>src/modules/comsys/</code></p>
<p><b>Features</b>:</p><ul>
<li>Communication channels</li>
<li>Channel management</li>
<li>Moderated channels</li>
<li>History storage</li>
</ul>
<p><b>Key Commands</b>:</p><ul>
<li><code>@channel</code> - Manage channels</li>
<li><code>+channel</code> or <code>+ch</code> - Communicate on channels</li>
</ul>
<h1><a class="anchor" id="autotoc_md205"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md206"></a>
1. Memory Management</h2>
<p>Always use server allocation macros:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a>()  <span class="comment">/* Allocate tracked memory */</span></div>
<div class="line">XSTRDUP()  <span class="comment">/* Duplicate string */</span></div>
<div class="line">XFREE()    <span class="comment">/* Free tracked memory */</span></div>
<div class="ttc" id="amacros_8h_html_a1f2dc397904297d0a9ba598093b19976"><div class="ttname"><a href="macros_8h.html#a1f2dc397904297d0a9ba598093b19976">XMALLOC</a></div><div class="ttdeci">#define XMALLOC(s, v)</div><div class="ttdoc">XMALLOC related macros.</div><div class="ttdef"><b>Definition</b> macros.h:21</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md207"></a>
2. Error Handling</h2>
<p>Check all return values and validate input:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!<a class="code hl_define" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a>(player, <span class="stringliteral">&quot;error message&quot;</span>))</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="ttc" id="amacros_8h_html_abe044d79896c3d56e758f742f4765f61"><div class="ttname"><a href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify</a></div><div class="ttdeci">#define notify(p, m,...)</div><div class="ttdef"><b>Definition</b> macros.h:226</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md208"></a>
3. Hash Tables</h2>
<p>Initialize and use hash tables for efficient lookups:</p>
<div class="fragment"><div class="line">hashinit(&amp;mod_&lt;name&gt;_htab, 100);</div>
<div class="line">hashfind(key, &amp;mod_&lt;name&gt;_htab);</div>
<div class="line">hashadd(key, data, &amp;mod_&lt;name&gt;_htab, <span class="stringliteral">&quot;source&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md209"></a>
4. Database Integrity</h2>
<p>Protect modifications to the database:</p>
<div class="fragment"><div class="line">db_touch(player);  <span class="comment">/* Mark database as modified */</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md210"></a>
5. Testing</h2>
<p>Test modules thoroughly:</p>
<ul>
<li>Unit tests for critical functions</li>
<li>Integration tests with server</li>
<li>Database corruption scenarios</li>
<li>Memory leak detection</li>
</ul>
<h2><a class="anchor" id="autotoc_md211"></a>
6. Documentation</h2>
<p>Document your module:</p>
<ul>
<li>Configuration parameters</li>
<li>Command syntax</li>
<li>Function behavior</li>
<li>Known limitations</li>
</ul>
<h2><a class="anchor" id="autotoc_md212"></a>
7. Version Management</h2>
<p>Define version information:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structmodule__version__info.html">MODVER</a> mod_&lt;name&gt;_version = {</div>
<div class="line">    <span class="stringliteral">&quot;module_name&quot;</span>,</div>
<div class="line">    1,  <span class="comment">/* major */</span></div>
<div class="line">    0,  <span class="comment">/* minor */</span></div>
<div class="line">    0,  <span class="comment">/* revision */</span></div>
<div class="line">};</div>
<div class="ttc" id="astructmodule__version__info_html"><div class="ttname"><a href="structmodule__version__info.html">module_version_info</a></div><div class="ttdoc">MUSH Configuration related typedefs.</div><div class="ttdef"><b>Definition</b> typedefs.h:722</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md213"></a>
Debugging Modules</h1>
<h2><a class="anchor" id="autotoc_md214"></a>
Compilation Errors</h2>
<p>Check:</p><ol type="1">
<li><code>api.h</code> is included</li>
<li>All symbols are declared or extern</li>
<li>Spelling and case sensitivity</li>
</ol>
<h2><a class="anchor" id="autotoc_md215"></a>
Runtime Errors</h2>
<ul>
<li>Use <code><a class="el" href="macros_8h.html#abe044d79896c3d56e758f742f4765f61">notify()</a></code> to log debug messages</li>
<li>Check server logs for crash dumps</li>
<li>Verify configuration parameters are correct</li>
</ul>
<h2><a class="anchor" id="autotoc_md216"></a>
Module Reload</h2>
<p>Modules load at server start. After changes:</p>
<ol type="1">
<li>Rebuild (<code>cmake --build build --target install-upgrade</code>)</li>
<li>Restart the server to pick up the new <code>.so</code></li>
</ol>
<h1><a class="anchor" id="autotoc_md217"></a>
Limitations and Constraints</h1>
<ul>
<li>Modules cannot be reloaded without server restart</li>
<li>Module symbols must not conflict with core or other modules</li>
<li>Only one backup of old <code>.so</code> files is kept</li>
<li>Modules have full access to database and server state</li>
</ul>
<h1><a class="anchor" id="autotoc_md218"></a>
References</h1>
<ul>
<li>Mail module: <code><a class="el" href="mail_8c.html" title="PennMUSH-compatible in-game mail delivery and mailbox management.">src/modules/mail/mail.c</a></code>, <code><a class="el" href="mail_8h.html" title="Interfaces and data structures for the PennMUSH-style mail subsystem.">src/modules/mail/mail.h</a></code></li>
<li>Comsys module: <code><a class="el" href="comsys_8c.html" title="DarkZone-style channel subsystem for player-to-player communication.">src/modules/comsys/comsys.c</a></code></li>
<li>Server API: <code>src/netmush/api.h</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md219"></a>
Support and Contributions</h1>
<p>For questions or to contribute module improvements:</p>
<ol type="1">
<li>Review existing module code</li>
<li>Follow the naming and coding conventions</li>
<li>Test thoroughly before publishing</li>
<li>Submit pull requests with documentation</li>
</ol>
<hr  />
<p><b>Note</b>: This guide applies to TinyMUSH 4.0 and later. Module API may change between versions. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
