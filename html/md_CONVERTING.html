<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TinyMUSH: CONVERTING</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TinyMUSH<span id="projectnumber">&#160;3.3</span>
   </div>
   <div id="projectbrief">TinyMUSH Server</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">CONVERTING </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >*** WARNING *** WARNING *** WARNING *** WARNING *** WARNING *** </p><hr  />
<p> *** THIS FILE IS OUTDATED AND WILL BE UPDATED IN THE FUTURE *** </p><hr  />
<p> *** WARNING *** WARNING *** WARNING *** WARNING *** WARNING ***</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md34"></a>
Converting from TinyMUX 1.0</h1>
<p >If you are converting your game from TinyMUX 1.x, upgrading to TinyMUSH 3.1 is just like doing a MUX version upgrade, with some additional steps. You will need to do the following:</p>
<ul>
<li>Flatfile your database using the dbconvert utility from TinyMUX (the db_unload script will work &ndash; this is just like doing a normal backup of your database).</li>
<li>Copy that flatfile to some safe place, and save it.</li>
<li>Edit mush.config and make sure it's correct (it should basically be like your old mux.config file).</li>
<li>If the GAMENAME parameter in your mush.config file is not 'netmush', edit your GAMENAME.conf file (substitute whatever you set GAMENAME to for GAMENAME).</li>
<li><p class="startli">Compare your GAMENAME.conf file to the default netmush.conf file. You'll note that there are some new parameters and some changes to old defaults. Update your conf file to reflect these changes. Two things that you'll definitely want to add are:</p>
<p class="startli">helpfile news text/news raw_helpfile man text/mushman</p><ul>
<li>If you have the following parameters set, simply remove them: cache_depth cache_width input_database output_database mail_database comsys_database have_comsys have_mailer format_exits format_contents</li>
<li>If you were using the built-in comsys, add this line: module comsys</li>
<li>If you were using the built-in mailer, add this line: module mail</li>
<li>If you had your database files in the data directory, add this line: database_home data (If you have your database files in another directory, substitute that in instead. Pathnames are relative to the ~/3.1/game directory.)</li>
<li>If you have the gdbm_database parameter in your conf file, edit it to take away any prepending path. For instance, if your conf file reads: gdbm_database data/netmush.gdbm change it to read: gdbm_database netmush.gdbm</li>
<li>If you have the crash_database parameter in your conf file, edit it to take away any prepending path. For instance, if your conf file reads: crash_database data/netmush.db.CRASH change it to read: crash_database netmush.db.CRASH</li>
</ul>
<p class="startli">You should also look at the "Compatibility Notes" section below, for any other configuration parameters you'll need to add or change.</p>
</li>
<li><p class="startli">Assuming that your flatfile is in the 'game' directory, go into the 'game' directory ('cd game').</p>
<p class="startli">If you have perl installed on your system, type: </p><pre class="fragment">./cvtmux.pl &lt; mygame.flat &gt; NEW.flatfile
</pre><p> If you do not have perl installed on your system, type: </p><pre class="fragment">sed -f cvtmux.sed mygame.flat &gt; NEW.flatfile 
</pre><p> (Substitute the name of your flatfile for 'mygame.flat'.) This will take care of converting function calls to backwards-compatible versions, and the 'c' substitution to the 'x' substitution.</p>
</li>
<li>From the game directory, type: ./Restore NEW.flatfile This will unflatfile (load) your database into TinyMUSH 3.1 format.</li>
<li>From the game directory, type: ./Backup This will back up your datbase in TinyMUSH 3.1 format. (This step is not necessary and can be skipped, but it's worthwhile doing anyway.)</li>
<li><p class="startli">Convert your comsys database. You must have perl installed on your system. From the game directory, type: </p><pre class="fragment">cp comsys.db comsys.db.save
./convert_comsys.pl &lt; comsys.db.save &gt; mod_comsys.db
</pre><p> Make sure to keep comsys.db.save someplace safe, in case something goes wrong in the conversion process.</p>
<p class="startli">If you do not have perl installed on your system, you will not be able to import your comsys database. (You could give a copy of the database, and the script, to a friend with perl on his system, and have him do it for you, though.) If you can't find a way to convert your comsys database, type: mv comsys.db comsys.db.save</p>
</li>
<li>Rename your mail database to the new 3.1 name: mv mail.db mod_mail.db <br  />
</li>
<li>From the game directory, type: ./Startmush This will start the game.</li>
</ul>
<hr  />
<p >Compatibility Notes</p>
<p >You will want the following parameters in your conf file, for maximum TinyMUX compatibility: </p><pre class="fragment">global_aconn_uselocks no
lattr_default_oldstyle no
addcommands_match_blindly yes
addcommands_obey_stop no
helpfile +help text/plushelp
helpfile wiznews text/wiznews
access wiznews wizard
</pre><p> Also, the default netmush.conf file has 'raw_helpfile news text/news' in it. If you want the old MUX behavior of 'news', where percent-substitutions and ANSI are evaluated in the news file, you will need to change that line to 'helpfile news text/news' instead.</p>
<p >Note that unless you explicitly need the legacy behavior of @addcommand'd commands (you want no Huh? message generated if an @addcommand is missed, and you match multiple @addcommands at once), you should probably set the last parameters to the opposite of their MUX-compatibility defaults.</p>
<hr  />
<p >Altered Behavior</p>
<p >The following are important changes in behavior between MUX and 3.0:</p>
<ul>
<li>MUX used 'c' for ANSI color. 3.0 uses 'x' for ANSI color ('c' is the last-command substitution, as it is in PennMUSH and TinyMUSH 2.2.)</li>
<li>MUX ifelse() conditioned on a non-zero result. 3.0 ifelse() conditions on a boolean-true result. To get the old behavior, use nonzero().</li>
<li>pmatch() now works as documented (i.e., identical to its PennMUSH predecessor). To get the old behavior, use pfind().</li>
<li>Objects are now checked for commands if they are set COMMANDS (instead of not being checked for commands if they are set NO_COMMAND).</li>
<li>ZMOs are now controlled by their ControlLock, not their EnterLock. Only objects that are set CONTROL_OK may be controlled according to their zone's ControlLock.</li>
<li>The COMPRESS flag has been eliminated. It was unused in MUX, though you could manually set it on objects.</li>
<li>The WATCHER flag is now used to watch logins, rather than MONITOR. The power to do this is now called Watch_Logsin, and it allows you to set WATCHER on objects that you own (rather than on objects that you control).</li>
<li>There is no longer a /dbref switch for @decompile; just use '@decompile &lt;object&gt;=&lt;dbref of object&gt;' to get the same effect.</li>
</ul>
<p >Your existing database was converted automatically to take the above differences into account.</p>
<p >The comsystem has been re-implemented. Some significant differences include:</p>
<ul>
<li>If you are starting a game from scratch, and thus have no comsys.db, on startup, the Public and Guests channels are created by default.</li>
<li>The channel administration commands have been consolidated to a single command, @channel, which takes a variety of switches. Channel objects are no longer necessary; data from them is automatically imported when you load a comsys database of the format generated by the convert_comsys.pl script.</li>
<li>Multiple aliases for a single channel work in a much saner manner. Each alias can be associated with a different comtitle.</li>
</ul>
<p >Other changes to be aware of:</p>
<ul>
<li>Two additional categories have been added to the stats() function. If you have softcode that extracts the number of garbage objects in the database from stats(), it will be fine if you used last(stats()) to get the data; if you used extract() or another function that depended upon list position, you will need to modify your code.</li>
<li>Though MUX's help files documented the behavior of teleport locks, the implementation didn't reflect the help. The implementation now works the way help says it does.</li>
</ul>
<hr  />
<p >The following is a list of features/functions that were in TinyMUSH 2.2.5, but were not in TinyMUX 1.6, and which have become part of 3.0.</p>
<p >For a more general look at TinyMUSH 3.0 changes, see the CHANGES file.</p>
<ul>
<li>Quotas by object type supported.</li>
<li>Added building_limit conf parameter.</li>
<li>Added player_parent, room_parent, exit_parent, thing_parent conf parameters for default parent objects.</li>
<li>Added log options keyboard_commands and suspect_commands.</li>
<li>Decent password choices are enforced via safer_passwords.</li>
<li>Guest can be locked out from sites via the guest_site parameter.</li>
<li>SIGUSR1 is logged, and the game restarts as GOD, not #1.</li>
<li>Note is written to log after @startup queue is run.</li>
<li>Disconnect log includes command count, bytes input, and bytes output.</li>
<li>New COMMANDS flag, the reverse of the NO_COMMAND flag, which has been eliminated.</li>
<li>New STOP flag, halts matching if a command is matched on a STOP object. (Wizard-only.)</li>
<li>NOSPOOF is only wiz-visible.</li>
<li>The color substitution is now 'x' rather than 'c'.</li>
<li>The 'c' substitution returns the last command.</li>
<li>Added "lag checking".</li>
<li>Added timechecking.</li>
<li>@daily is now implemented using the @cron facility.</li>
<li>@dump/optimize no longer exists, since the database is optimized after every dump.</li>
<li>@doing truncates the minimum possible (i.e., don't truncate for the ANSI character unless necessary).</li>
<li>Added @dolist/notify.</li>
<li>@enable/@disable now appear in the logfile, like config updates do.</li>
<li>Added @eval command.</li>
<li>examine/brief now shows everything but the attributes on the object.</li>
<li>INFO command implemented.</li>
<li>Added '@list cache'.</li>
<li>Hash statistics listing shows stats for @function hash table.</li>
<li>@mvattr no longer clears the original attribute unless it was able to copy it at least once.</li>
<li>@pemit/noeval permits unparsed output.</li>
<li>@pemit/list now obeys the /contents switch.</li>
<li>There is a space after the @program prompt (2.2 behavior).</li>
<li>Added object count to @search.</li>
<li>@stats shows the next dbref to be created.</li>
<li>The #$ @switch/switch() token has been added.</li>
<li>Added @conformat and @exitformat contents and exits formatting.</li>
<li>Command matches can be done unparsed through no_eval attribute flag.</li>
<li>New BOUNCE flag acts like equivalent of @listen of '*' without @ahear.</li>
<li>Added bor(), band(), bnand() functions.</li>
<li>die() checks its arguments 2.2-style (so 0-100 is valid).</li>
<li>Added filterbool() function.</li>
<li>ifelse() now conditions on a boolean, rather than on a non-zero number.</li>
<li>Added nonzero() function, which behaves like ifelse() used to.</li>
<li>lastcreate() and the NewObjs attribute keep track of last-created objects for a given thing.</li>
<li>Added lpos() function.</li>
<li>matchall() returns a null string, not 0, on no match.</li>
<li>mix() can take up to ten arguments total.</li>
<li>objeval() now preserves the cause (enactor) in the evaluation, and allows the calling object to succeed if its owner is the same as the evaluator's owner, instead of needing to <em>be</em> the evaluator's owner (2.2 behavior).</li>
<li>Added programmer() function.</li>
<li>Added remit() function, like pemit() but does contents.</li>
<li>restarts() and restarttime() added.</li>
<li>Added sees() function.</li>
<li>shl(), shr(), inc(), dec() no longer require inputs to be numbers (2.2 behavior).</li>
<li>Added t() function.</li>
<li>Added toss() function.</li>
<li>Vector functions replaced by 2.2 ones, including addition of vdot(). This means that vector multiplication now works, but it breaks the old MUX behavior of vmul().</li>
<li>Added wipe() function.</li>
<li>Added xcon() function.</li>
<li>elements(), filter(), map(), munge(), setunion(), setinter(), setdiff(), shuffle(), sort(), sortby(), splice() take output delimiters.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md39"></a>
Converting from TinyMUSH 2.2</h1>
<p >If you are converting your game from TinyMUSH 2.2, upgrading to TinyMUSH 3.1 is similar to doing a normal upgrade, with a couple of additional steps. You will need to do the following:</p>
<ul>
<li>Flatfile your database using the dbconvert utility from TinyMUSH 2.2 (the db_unload script will work &ndash; this is just like doing a normal backup of your database).</li>
<li>Copy that flatfile to some safe place, and save it.</li>
<li>The file directory structure has been altered. All game files now go into the 'game' directory. You'll want to move your database files into the 'data' directory, and your text files into the 'text' directory.</li>
<li>Edit mush.config and make sure that it's correct; it's basically like the old mush.config file from TinyMUSH 2.2, with some additional things.</li>
<li>If the GAMENAME parameter in your mush.config file is not 'netmush', edit your GAMENAME.conf file (substitute whatever you set GAMENAME to for GAMENAME).</li>
<li><p class="startli">Compare your GAMENAME.conf file to the default netmush.conf file. You'll note that there are some new parameters and some changes to old defaults. Update your conf file to reflect these changes. The important ones are:</p>
<p class="startli">raw_helpfile news text/news raw_helpfile man text/mushman database_home data</p>
<p class="startli">If you have them set, delete the input_database and output_database parameters.</p>
<p class="startli">If you would like to use in the built-in comsys and mailer, add:</p>
<p class="startli">module comsys module mail</p>
<p class="startli">You should also look at the "Compatibility Notes" section below, for any other configuration parameters you'll need to add or change.</p>
</li>
<li><p class="startli">Assuming that your flatfile is in the 'game' directory, go into the 'game' directory ('cd game').</p>
<p class="startli">If you have perl installed on your system, type: </p><pre class="fragment">./cvt22.pl &lt; mygame.flat &gt; NEW.flatfile
</pre><p> If you do not have perl installed on your system, type: </p><pre class="fragment">sed -f cvt22.sed mygame.flat &gt; NEW.flatfile 
</pre><p> (Substitute the name of your flatfile for 'mygame.flat'.) This will take care of converting function calls to backwards-compatible versions.</p>
</li>
<li>From the game directory, type: ./Restore NEW.flatfile This will unflatfile (load) your database into TinyMUSH 3.1 format.</li>
<li>From the game directory, type: ./Backup This will back up your datbase in TinyMUSH 3.1 format. (This step is not necessary and can be skipped, but it's worthwhile doing anyway.)</li>
<li>From the game directory, type: ./Startmush This will start the game.</li>
</ul>
<hr  />
<p >Compatibility Notes</p>
<p >You will want the following parameters in your conf file, for maximum 2.2 compatibility: </p><pre class="fragment">global_aconn_uselocks yes
lattr_default_oldstyle yes
addcommands_match_blindly no
addcommands_obey_stop yes
</pre><p >Virtually everything can be tweaked, disabled, or otherwise altered to fit whatever behavior you happen to want the server to have. All it takes is some modifications to your conf file (netmush.conf, or whatever you called it).</p>
<ul>
<li>I don't want to use the built-in mailer. Just leave out the 'module mail' parameter from your conf file.</li>
<li>I don't want to use the built-in comsys (channel/chat system). Just leave out the 'module comsys' parameter from your conf file.</li>
<li>I don't want to allow zone control with ZMOs. Put 'have_zones no' in your conf file.</li>
<li>I don't want to allow powers to be set on objects. Put 'access @power disabled' in your conf file.</li>
<li>I don't like the last-paged feature. Put 'page_requires_equals yes' in your conf file. This will enforce the use of an equals sign to page someone again, i.e., 'page =&lt;message&gt;' is needed, not just 'page &lt;message&gt;'. This should prevent virtually all last-paged-related mishaps.</li>
<li>I don't want to allow @conformat and/or @exitformat to be used. Put 'attr_access ConFormat disabled' and/or 'attr_access ExitFormat disabled' in your conf file.</li>
<li>I don't want side-effect functions. Put the following in your conf file: function_access command disabled function_access create disabled function_access force disabled function_access link disabled function_access set disabled function_access tel disabled function_access trigger disabled function_access wait disabled function_access wipe disabled If you want to be really draconian, also add to the conf file: function_access pemit disabled function_access remit disabled</li>
</ul>
<hr  />
<p >Altered Behavior</p>
<p >The following are important changes in behavior between 2.2 and 3.0:</p>
<ul>
<li>objmem() behaves differently, taking into account the object structure as well as attribute text. To get the equivalent behavior to 2.2's objmem(&lt;obj&gt;), use objmem(&lt;obj&gt;/*)</li>
<li>hasattr() no longer checks for the presence of the attribute on the object's parent chain. To get the equivalent of the 2.2 behavior, use hasattrp() instead. Your existing database was automatically converted to take this difference into account.</li>
<li>Two additional categories have been added to the stats() function. If you have softcode that extracts the number of garbage objects in the database from stats(), it will be fine if you used last(stats()) to get the data; if you used extract() or another function that depended upon list position, you will need to modify your code.</li>
</ul>
<hr  />
<p >The following is a list of features/functions that were in TinyMUX 1.6, but were not in TinyMUSH 2.2.5, and which have become part of 3.0.</p>
<p >For a more general look at TinyMUSH 3.0 changes, see the CHANGES file.</p>
<ul>
<li>The TinyMUX powers system has been added.</li>
<li>Added the MUX mailer. (Config option, on by default.)</li>
<li>Added the MUX com system. (Config option, on by default.)</li>
<li>The Guest system has been replaced by the MUX Guest system.</li>
<li>DNS lookups are now done by a slave process (automatically started at startup, or through @startslave); the server will no longer block for them.</li>
<li>Support for identd.</li>
<li>Max login record kept and displayed in WHO.</li>
<li>Added indent_desc config parameter.</li>
<li>Buffer size is now 8000 characters (doubled).</li>
<li>Output block size is now a compile-time parameter.</li>
<li>Auto-restart on crash controlled by signal_action conf parameter.</li>
<li>Attribute caching has been eliminated.</li>
<li>Memory-based databases supported.</li>
<li>Wizards can connect dark via the 'cd' command.</li>
<li>Added '@cpattr' command.</li>
<li>@daily implemented; enabled by 'eventchecking' global parameter, time set by events_daily_hour.</li>
<li>Added @dbclean command, which removes stale attribute names from the database.</li>
<li>Destruction of all objects is delayed until a dbck is done, as was previously true just for rooms. (Exception: DESTROY_OK objects.)</li>
<li>@edit hilites the changed text.</li>
<li>examine/brief now shows everything but the attributes on the object. To get the old behavior (just showing the owner), use examine/owner.</li>
<li>'@function/preserve' preserves registers across user-defined functions.</li>
<li>'@list process' shows the number of descriptors available.</li>
<li>Multi-page and last-paged are now supported.</li>
<li>@search supports a GARBAGE class.</li>
<li>Added 'think' command.</li>
<li>Semaphore @wait can now block on a user-specified attribute.</li>
<li>Added @tofail/@otofail/@atofail (messages for failing to teleport out).</li>
<li>Added the ROYALTY flag.</li>
<li>Added SpeechLock/AUDITORIUM support.</li>
<li>Added FIXED flag (prevents teleporting or going home), with conf parameters fixed_home_message and fixed_tel_message.</li>
<li>The GAGGED flag is back.</li>
<li>Added marker flags: HEAD, STAFF, UNINSPECTED.</li>
<li>TRANSPARENT flag on room shows exits in "long" style.</li>
<li>Added VACATION flag, which auto-resets when a player connects.</li>
<li>Added WATCHER flag, and Watch_Logins power, which is equivalent to the connection monitoring functionality of MUX's MONITOR flag.</li>
<li>hasattr() no longer finds attributes on parents; use the new hasattrp() function for the old hasattr() behavior.</li>
<li>Added alphamax(), alphamin() functions.</li>
<li>Added art() function.</li>
<li>Added beep() function.</li>
<li>Added case() function.</li>
<li>Added children(), lparent() functions.</li>
<li>Added columns() function.</li>
<li>Added encrypt(), decrypt() functions.</li>
<li>Added grep(), grepi() functions.</li>
<li>Added hastype() function.</li>
<li>Added playmem() function.</li>
<li>Added pmatch() function.</li>
<li>Added strcat() function.</li>
<li>Added strtrunc() function.</li>
<li>Note that side-effect functions that fail now generally return #-1 NOT a null string (MUX behavior). If you want to guarantee a null return, wrap the call in a null(). </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
